;ÒAMÃARTÂURSTÂACKUP BY ÙÔÍ/ÁLLIANCE;07.08.1997;KOPIOWANIE:;É TURA;1-7, 8-14, 15-19 - Z PRZENIESIENIEM;20-28            - DO RAM;ÉÉ TURA;28-35            - DO RAMDRCODE   = $1100DRV      = $0400BUFF     = $1500TL       = $22TH       = $23MB       = $24SB       = $25LB       = $27HB       = $28TR       = $29LB2      = $FEHB2      = $FFPR       .MACRO         LDA #<\1         LDY #>\1         JSR $AB1E         .ENDMKEY      .MACRO         JSR $FFE4         BEQ *-3         .ENDM         *= $0850         LDA #$17         STA $D018         LDA #0         STA $D020         STA $D021         LDA #$0F         STA $0286         JSR $E544TEST     LDA #0         STA $DE00         STA $DE01         LDA $DF00         STA MEMX         LDA #"M"         STA $DF00         LDA $DF00         STA MEMX+1         LDA MEMX         STA $DF00         LDA MEMX+1         CMP #"M"         BEQ TCONTTFAULT   #PR PRZELACZ         #KEY         JMP TESTTCONTSTART    LDA #8         STA $BA         LDA #<NMI         STA $0318         LDA #>NMI         STA $0319         #PR INITEXT         LDX #0         LDY #0CLL      TXA         ORA #$30         STA SECTEXT+1         TYA         ORA #$30         STA SECTEXT+2         STX MEMX         STY MEMY         #PR SECTEXT         LDY MEMY         LDX MEMX         INY         CPY #10         BNE CLL         LDY #0         INX         CPX #2         BNE CLL         LDY #0         TXA         ORA #$30         STA SECTEXT+1         TYA         ORA #$30         STA SECTEXT+2         #PR SECTEXT         LDA #"V"         STA $0400+(21*40)+20+2         LDA #"E"         STA $0400+(21*40)+21+2         LDA #"R"         STA $0400+(21*40)+22+2         LDA #"."         STA $0400+(21*40)+23+2         LDA #" "         STA $0400+(21*40)+24+2         STA $0400+(21*40)+27+2         LDA #"O"         STA $0400+(21*40)+25+2         LDA #"N"         STA $0400+(21*40)+26+2         LDA #$2C         STA BYTE         #PR OPCJEMAIN     #KEY         CMP #135         BNE NIEVER         JSR CHNGVER         JMP MAINNIEVER   CMP #133         BNE NIECOPY         JSR COPYFULL         JMP MAINNIECOPY  CMP #134         BNE NIESCAN         JSR FASTSCAN         JMP MAINNIESCAN  CMP #136         BNE NIEDIR         JSR DIR         JMP STARTNIEDIR   JMP MAINNMI      RTIMEMX     .BYTE 0MEMY     .BYTE 0;---------------------------------------DIR      JSR $E544         LDA #1         LDX $BA         LDY #0         JSR $FFBADLEN     LDA #1         LDX #<TYT         LDY #>TYT         JSR $FFBD         LDA #1         JSR $FFC0         LDX #1         LDA #1         JSR $FFC6         JSR $FFCF         JSR $FFCFLICZBA   JSR $FFCF         JSR $FFCF         LDA $90         AND #%01000000         BNE KNC         JSR $FFCF         TAX         LDA $91         BPL KNC         JSR $FFCF         JSR $BDCD         LDA #" "         JSR $FFD2CZYTAJ   JSR $FFCF         BNE BOM         LDA #13         JSR $FFD2         JMP LICZBABOM      JSR $FFD2         LDA $D6         BEQ CZYTAJ         LDA $D3         CMP #24         BMI CZYTAJ         JMP CZYTAJKNC      LDA #1         JSR $FFC3         JSR $FFCC         #PR DENDDWAI     #KEY         CMP #" "         BNE DWAI         RTSTYT      .TEXT "$"DEND     .BYTE 13,18         .TEXT " PRESS SPACE "         .BYTE 146,0;---------------------------------------SOURCEON JSR TEXTOFF         CLC         LDY #0         LDX #24         JSR $FFF0         #PR SOURCE         LDA #$0B         STA $D020         CLC         #KEY         LDX #0         STX $D020         CMP #3         RTSTARGETON JSR TEXTOFF         CLC         LDY #0         LDX #24         JSR $FFF0         #PR TARGET         LDA #$0B         STA $D020         #KEY         LDX #0         STX $D020         CMP #3         RTSTEXTOFF  LDA #" "         LDX #0CLRLP    STA $0400+(24*40),X         INX         CPX #40         BNE CLRLP         RTS;---------------------------------------FASTSCAN LDA #$24         STA HERE1         STA HERE2         JSR SOURCEON         BEQ FSCEND         LDX #1         LDY #35         JSR READTRACKSFSCEND   LDA #$91         STA HERE1         STA HERE2         JSR TEXTOFF         RTS;---------------------------------------CHNGVER  LDA BYTE         EOR #$60         STA BYTE         CMP #$2C         BEQ VERON         LDA #"F"         STA $0400+(21*40)+26+2         STA $0400+(21*40)+27+2         RTSVERON    LDA #"N"         STA $0400+(21*40)+26+2         LDA #" "         STA $0400+(21*40)+27+2         RTS;---------------------------------------COPYFULL LDA #0         STA LB2         STA HB2         JSR SOURCEON         BEQ CFEND         LDX #1         LDY #7         JSR READTRACKS         JSR COPY2RC         LDX #8         LDY #14         JSR READ2         JSR COPY2RC         LDX #15         LDY #19         JSR READ2         JSR COPY2RC         LDX #20         LDY #28         JSR READ2         JSR TARGETON         BEQ CFEND         LDX #20         LDY #28         JSR WRITETRACKS         LDA #0         STA LB2         STA HB2         JSR COPYFROMRC         LDX #1         LDY #7         JSR WRITE2         JSR COPYFROMRC         LDX #8         LDY #14         JSR WRITE2         JSR COPYFROMRC         LDX #15         LDY #19         JSR WRITE2         JSR SOURCEON         BEQ CFEND         LDX #29         LDY #35         JSR READTRACKS         JSR TARGETON         BEQ CFEND         LDX #29         LDY #35         JSR WRITETRACKSCFEND    JSR TEXTOFF         RTS;---------------------------------------COPY2RC  SEI         LDA #$35         STA $01         LDA #<BUFF         LDX #>BUFF         STA TL         STX TH         INC SBLPLP0    LDA LB2         STA $DE00         LDA HB2         STA $DE01         LDY #0LPLP     LDA (TL),Y         STA $DF00,Y         INY         BNE LPLP         INC TH         INC LB2         BNE *+4         INC HB2         LDA TH         CMP SB         BNE LPLP0         LDA #$37         STA $01         CLI         RTSCOPYFROMRC SEI         LDA #$35         STA $01         LDA #<BUFF         LDX #>BUFF         STA TL         STX THLP2LP0   LDA LB2         STA $DE00         LDA HB2         STA $DE01         LDY #0LP2LP    LDA $DF00,Y         STA (TL),Y         INY         BNE LP2LP         INC TH         INC LB2         BNE *+4         INC HB2         LDA TH         CMP #$CF         BNE LP2LP0         LDA #$37         STA $01         CLI         RTSREAD2    TYA         PHA         TXA         STA TR         LDX #<(DRV+$018B)         LDY #>(DRV+$018B)         JSR TRRR         PLA         LDX #<(DRV+$0154)         LDY #>(DRV+$0154)         JSR TRRR         JMP READ2TRWRITE2   TYA         PHA         TXA         STA TR         LDX #<(DRV+$03BA-$01BA)         LDY #>(DRV+$03BA-$01BA)         JSR TRRR         PLA         LDX #<(DRV+$037E-$01BA)         LDY #>(DRV+$037E-$01BA)         JSR TRRR         JMP WRITE2TRTRRR     STA WHAT         STX ADDD         STY ADDD+1         LDA $BA         JSR $FFB1         LDA #$6F         JSR $FF93         LDX #0TRRRLP   LDA ORDER,X         JSR $FFA8         INX         CPX #8         BNE TRRRLP         JMP $FFAE;---------------------------------------READTRACKS         STX DRCODE+$018B         STX TR         STY DRCODE+$0154         LDX #<DRCODE         LDY #>DRCODE         LDA #2         JSR FASTMWREAD2TR  LDA $DD0D         LDX #$78         LDY #$05         JSR DREXEC         JSR INIT         LDA #<BUFF         STA MB         LDA #>BUFF         STA SB         LDA $DD0D         BEQ *-3         LDA $DD01         CMP #$02         BCS FINMAINREAD LDA $DD0D         BEQ *-3         LDX $DD01         BNE NOTENDFIN      JMP DONENOTEND   LDA TR         CLC         ADC #$52         STA LB         LDA #$04         STA HB         INC TRRDLP0    LDA $DD0D         BEQ *-3         LDA $DD01         BNE FAULT         LDY #$00RDLP1    LDA $DD0D         BEQ *-3         LDA $DD01HERE1    STA (MB),Y         INY         BNE RDLP1         INC SBRDLP2    LDA $DD0D         BEQ *-3         LDA $DD01HERE2    STA (MB),Y         INY         CPY #$43         BNE RDLP2         LDA $DD0D         BEQ *-3         LDA $DD01FAULT    PHP         LDA #$3F         PLP         BNE ERR         LDA #$2AERR      LDY #$00         STA (LB),Y         LDA LB         CLC         ADC #$28         STA LB         BCC RDLP4         INC HBRDLP4    LDA MB         CLC         ADC #$43         STA MB         LDA SB         ADC #$00         CMP #$FF         BCC RDLP5         LDA #$80       ;^         STA MB         ;^         LDA #$12         BNE RDNEXTRDLP5    CMP #$E0         BCS RDNEXT         CMP #$CF         BCC RDNEXT         LDA #$00         STA MB         LDA #$E0RDNEXT   STA SB         DEX         BNE RDLP0         JMP MAINREAD;---------------------------------------WRITETRACKS         STX DRCODE+$03BA         STX TR         STY DRCODE+$037E         LDA BYTE         STA DRCODE+$029B         LDX #<(DRCODE+$01BA)         LDY #>(DRCODE+$01BA)         LDA #3         JSR FASTMWWRITE2TR LDA $DD0D         LDX #$E8         LDY #$05         JSR DREXEC         JSR INIT         LDA #<BUFF         STA MB         LDA #>BUFF         STA SB         LDA $DD0D         BEQ *-3         LDA $DD01MAINWRITE         LDA $DD0D         BEQ *-3         LDX $DD01         BNE NOTEND2         JMP DONENOTEND2  LDA #$FF         STA $DD03         LDA TR         CLC         ADC #$52         STA LB         LDA #$04         STA HB         INC TRWRLP0    LDY #$00         LDA (MB),Y         STA $DD01         INYWRLP1    LDA $DD0D         BEQ *-3         LDA (MB),Y         STA $DD01         INY         BNE WRLP1         INC SBWRLP2    LDA $DD0D         BEQ *-3         LDA (MB),Y         STA $DD01         INY         CPY #$43         BNE WRLP2         LDA MB         CLC         ADC #$43         STA MB         LDA SB         ADC #$00         CMP #$FF         BCC WRLP3         LDA #$80     ;^         STA MB       ;^         LDA #$12         BNE WRLP4WRLP3    CMP #$E0         BCS WRLP4         CMP #$CF         BCC WRLP4         LDA #$00         STA MB         LDA #$E0WRLP4    STA SB         LDA $DD0D         BEQ *-3         DEX         BNE WRLP0         LDA #$00         STA $DD03BYTE     BIT MAINWRITE         LDA $DD0D         BEQ *-3         LDX $DD01WRLP5    LDA $DD0D         BEQ *-3         LDA $DD01         PHP         LDA #$3F         PLP         BNE WRLP6         LDA #$2AWRLP6    LDY #$00         STA (LB),Y         LDA LB         CLC         ADC #$28         STA LB         BCC WRLP7         INC HBWRLP7    DEX         BNE WRLP5         JMP MAINWRITE;---------------------------------------INIT     SEI         LDA #$35         STA $01INLP     LDA $D012         BNE INLP         STA $D015         LDA #$0B         STA $D011         RTSDONE     LDA #$1B         STA $D011         LDA #$00         STA $DD03         LDA #$37         STA $01         CLI         RTS;---------------------------------------FASTMW   STA X0+1         STA DRHOW2+1         LDA #$50         STA MB         LDA #<DRVCD         STA TL         LDA #$01         STA SB         LDA #$00         STA $D015         LDA #>DRVCD         STA TH         STX X3+1         STY X3+2         JSR MEW         BCC *+7DRERROR  CLI         SEC         LDA #$80         RTS         LDA #$23         STA $DD00         BIT $DD00         BVS *-3X0       LDA #$02         STA $02X1       BIT $DD00         BVC *-3         LDY #$00X3       LDA $1000,Y         PHA         LSR A         LSR A         LSR A         LSR A         TAX         SECX4       LDA $D012         SBC #$32         BCC X5         AND #$07         BEQ X4X5       LDA #$03         STA $DD00         LDA TABKON,X         STA $DD00         LSR A         LSR A         AND #$F7         STA $DD00         PLA         AND #$0F         TAX         LDA TABKON,X         STA $DD00         LSR A         LSR A         AND #$F7         STA $DD00         LDA #$23         NOP         NOP         INY         STA $DD00         BNE X3         INC X3+2         DEC $02         BNE X1         LDA #$20         CMP $D012         BNE *-3         LDX #$1B         STX $D011         LDA $DD00         AND #%11111100         ORA #%00000011         STA $DD00         CLC         RTS;---------------------------------------TABKON   .BYTE $07,$87,$27,$A7,$47,$C7         .BYTE $67,$E7         .BYTE $17,$97,$37,$B7,$57,$D7         .BYTE $77,$F7;---------------------------------------DRVCD    SEI         JSR $019C         LDA #$7A         STA $1802         JSR $F5E9DRHOW2   LDA #$03         STA $06DRV1     JSR $0173         INC $0198         DEC $06         BNE DRV1         LDA #$10         STA $1C07         NOP         NOP         NOP         RTS         LDY #$00         STY $1800DRV2     LDA $1800         BNE *-3         PHP         LDA $1800         ASL A         PLP         EOR $1800         ASL A         ASL A         ASL A         NOP         NOP         NOP         EOR $1800         ASL A         NOP         NOP         NOP         EOR $1800         STA $0400,Y         INY         BNE DRV2         LDA #$08         STA $1800         RTS;---------------------------------------MEW      LDX #3LOOP     LDA $BA         JSR $FFB1         LDA #$00         STA $90         LDA #$6F         JSR $FF93         BIT $90         BPL DALEJ         SEC         RTSDALEJ    LDA #$4D         JSR $FFA8         LDA #$2D         JSR $FFA8         LDA #$57         JSR $FFA8         LDA MB         JSR $FFA8         LDA SB         JSR $FFA8         LDA #$20         JSR $FFA8         LDY #$00LOOP1    LDA (TL),Y         JSR $FFA8         INY         CPY #$20         BNE LOOP1         JSR $FFAE         LDA MB         CLC         ADC #$20         STA MB         BCC *+4         INC SB         LDA TL         CLC         ADC #$20         STA TL         BCC *+4         INC TH         DEX         BNE LOOP         LDX #$50         LDY #$01         JSR DRADDYMEX      LDA $BA         JSR $FFB1         LDA #$6F         JSR $FF93         LDX #$00         LDA MEX1,X  ;ZM3         JSR $FFA8         INX         CPX #$05         BNE *-9         JSR $FFAE         SEI         CLC         RTSDRADDY   STX TRANS         STY TRANS+1         RTSDREXEC   JSR DRADDY         JMP MEX;---------------------------------------MEX1     .TEXT "M-E"TRANS    .BYTE $50,$01ORDER    .TEXT "M-W"ADDD     .BYTE 0,4,1WHAT     .BYTE 1INITEXT  .BYTE 147         .TEXT "Ò-ÃÂAC/ÙÔÍ  "         .TEXT "1111111111"         .TEXT "2222222222333333"         .BYTE 13         .TEXT "   1234567890123456789"         .TEXT "0123456789012345"         .BYTE 13         .BYTE 0SECTEXT  .TEXT " 00.................."         .TEXT "................."         .BYTE 13,0OPCJE    .TEXT " Æ1 - ÃOPY Æ3 - ÓCAN "         .TEXT "Æ5 - ÖER. Æ7 - ÄIR"         .BYTE 0SOURCE   .TEXT "     ÉNSERT SOURCE DISK"         .BYTE 0TARGET   .TEXT "     ÉNSERT TARGET DISK"         .BYTE 0PRZELACZ .BYTE 147         .NULL "    PRZELACZ W ZAPIS!"